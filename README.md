# Summary
Allows you to restrict weapon based on a percentage quota and a hard cap.

# Installation
1. Download the `.dll` file in the releases page
2. Create a folder named `WeaponRestrict` in `/game/csgo/addons/counterstrikesharp/plugins` and move the `WeaponRestrict.dll` into the folder you just created
3. Start the server
5. Configure the auto-generated config in `/game/csgo/addons/counterstrikesharp/configs/plugins/WeaponRestrict/WeaponRestrict.json` to your liking using the guide below
6. *(Optional) Reload the plugin using `css_plugins reload [plugin index]` to update the loaded config (you can get the index by running `css_plugins list`)*

# Config
## Messages
You can customize the `MessagePrefix`, `RestrictMessage` and `DisabledMessage`. To not use the `DisabledMessage` leave it as an empty string ("").

For `RestrictMessage` use `{0}` for the weapon name and `{1}` for the limit.

For `DisabledMessage` use `{0}` for the weapon name. 

When formatting the messages with colors, use the escaped character code or `{Color.*}` where `*` is the exact name of the field from [this class](https://github.com/roflmuffin/CounterStrikeSharp/blob/5c9d38b2b006e7edf544bb8f185acb4bd5fb6722/managed/CounterStrikeSharp.API/Modules/Utils/ChatColors.cs#L21). 

For example, to use the light purple color use `{Color.LightPurple}` and NOT `{Color.lightPurple}` or any other case variant.

You can configure the minimum delay between messages when a player is attempting to pick up a weapon many times with the `MessageCooldownSeconds` number. It specifies the amount of seconds (with decimal support) between messages. (1.5 = 1 and a half second between messages). If set to 0 or below, messages will not be sent on pickup.

**Note:** Messages will still be sent when attempting to purchase items.

## Weapon Restrictions
The default config is located under `DefaultConfig`. This contains two keys; `WeaponQuotas` and `WeaponLimits`.

To completely disable a weapon, set the `WeaponQuotas` **or** `WeaponLimits` for the desired weapon to 0.

`WeaponQuotas` is a decimal number used for a percentage of players (0.2 = 20%, for every 5th person a new weapon is allowed), either on the total players or for the team (depending on `DoTeamCheck`).

`WeaponLimits` is a hard cap per weapon (1 = 1 AWP total/per team, also caps out the `WeaponQuotas` value).

You can use one, both, or none of `WeaponQuotas` and `WeaponLimits`. If you do not want any restrictions by default, leave them empty but do not completely delete them.

## Additional flags
`AllowPickup` will allow anyone to pick up the restricted weapons after buytime is over, but not allow the purchase if the limit is met on their team. Do note that this is easily bypassable by holders dropping the weapons until other players purchase and picking up when buytime is over.

`RestrictWarmup` will restrict weapon usage in warmup if set to true. If set to false, restrictions are not applied on warmup period.

You can use the `VIPFlag` to enable VIP bypass for a permission group, or use an empty string ("") to disable the check.

The example config will allow 20% of the players on either team to have an AWP, with a hard limit of 1 per team. Meaning if you have at least 5 players on a team, they get one AWP. 
VIPs are completely ignored and can always buy, drop and pick up the AWP.

## Map configs
`MapConfigs` is an **optional** dictionary of maps which contains the same structure of `WeaponQuotas` and `WeaponLimits`. Both are optional.
If you specify a map name and do not specify any quotas or limits, the map will load unrestricted. See `awp.*` in the example config.
You can use a [regular expression](https://regex101.com/) for the map name. Do note that the pattern is already wrapped in `^` and `$` for simplicity.

If you do not want to add any overrides to maps, make `MapConfigs` an empty object as such:
`"MapConfigs": {}`. If you don't do this, the default config will be loaded.

## Default config
This is the default config generated by the plugin:
```json
{
  "MessagePrefix": "{Color.Orange}[WeaponRestrict] ",
  "RestrictMessage": "{Color.LightPurple}{0}{Color.Default} is currently restricted to {Color.LightRed}{1}{Color.Default} per team.",
  "DisabledMessage": "{Color.LightPurple}{0}{Color.Default} is currently {Color.LightRed}disabled{Color.Default}.",
  "MessageCooldownSeconds": 10,
  "DefaultConfig": {
    "WeaponQuotas": {
      "weapon_awp": 0.2
    },
    "WeaponLimits": {
      "weapon_awp": 1
    }
  },
  "DoTeamCheck": true,
  "AllowPickup": false,
  "RestrictWarmup": true,
  "VIPFlag": "@css/vip",
  "MapConfigs": {
    "awp.*": {
      "WeaponQuotas": {},
      "WeaponLimits": {}
    }
  },
  "ConfigVersion": 5
}
```

# Commands
`css_restrictweapon (!restrictweapon)` lets you restrict, unrestrict or reset any weapon until next map change or plugin reload. Usage: `css_restrictweapon weapon_name [[default/none] | [quota/limit value]]`.
